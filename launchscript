#!/bin/sh

scriptname="launch script"
scriptdisc='script to launch programs in $PATH with extras'
. zconf


addoptions(){
if [ -z "$EXTRAOPTIONS" ]
then
	EXTRAOPTIONS="$1"
else
EXTRAOPTIONS="$EXTRAOPTIONS\n$1"
fi
}
if [ -z "$BROWSER" ]
then
	BROWSER="firefox"
fi
loadconfig(){
#syntax      "app_name" "exec" "if it should add option if there is no binary in $PATH"
launchexcept "heroic" "heroic --ozone-platform-hint=auto $arg2"
launchexcept "signal-desktop" "signal-desktop --ozone-platform-hint=auto $arg2"
launchexcept "ripcord" "env QT_QPA_PLATFORM_PLUGIN_PATH=/usr/lib/qt/plugins ripcord $arg2"


if [ -z "$STEAM_SDL_VIDEODRIVER" ]
then
	STEAM_SDL_VIDEODRIVER="X11"
fi
if command -v "mullvad-exclude" > /dev/null 2>&1
then
launchexcept "steam" "mullvad-exclude env SDL_VIDEODRIVER='$STEAM_SDL_VIDEODRIVER' steam $arg2"
else
launchexcept "steam" "env SDL_VIDEODRIVER='$STEAM_SDL_VIDEODRIVER' steam $arg2"
fi
#launchexcept "discord" "$BROWSER www.discord.com/app" "1"
launchexcept "skype" "chromium web.skype.com" "1"
launchexcept "bitpaper" "$BROWSER https://bitpaper.io/go/zuki1/AFgaDpJzQ" "1"
launchexcept "virtual-piano" "$BROWSER https://www.onlinepianist.com/virtual-piano" "1"
launchexcept "panel-attack" "love $HOME/src/panel-attack" "1"
}
launchexcept(){
if [ "$3" = "1" ] && ! command -v "$1" > /dev/null 2>&1
then
	addoptions "$1"
fi
}


loadconfig
test="$({ set -f; IFS=:; for d in $PATH; do set +f; [ -n "$d" ] || d=.; for f in "$d"/.[!.]* "$d"/..?* "$d"/*; do [ -f "$f" ] && [ -x "$f" ] && printf '%s\n' "${f##*/}"; done; done; })"
launch="$(printf "$test\n$EXTRAOPTIONS" | sort | "$@")"

set -- $launch
arg1=($launch)
if [ "$#" != "1" ]
then
x="$launch"
arg2="${x#* }"
arg2="${x#* }"
#else
#arg2="arg2 not set"
fi

echo "launch=$launch"
echo "arg1=$arg1"
echo "arg2=$arg2"

launchsyntax(){
nohup $1 > /dev/null 2>&1&
}

launchexcept(){
if [ "$arg1" = "$1" ]
then
	launchsyntax "$2"
	exit
fi
}
loadconfig
launchsyntax "$launch"
exit
